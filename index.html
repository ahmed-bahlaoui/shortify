<!doctype html>

<html class="light dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>URL Shortener</title>
    <link href="./src/output.css" rel="stylesheet" />
    <link rel="icon" href="web/favicon-16.png" type="image/png" sizes="16x16">
    <link rel="icon" href="web/favicon-32.png" type="image/png" sizes="32x32">
    <link rel="icon" href="web/favicon-96.png" type="image/png" sizes="96x96">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-text-main-light dark:text-text-main-dark min-h-screen flex flex-col transition-colors duration-200">
    <!-- Main Content -->
    <main class="grow flex flex-col items-center justify-center relative overflow-hidden py-12 px-4 sm:px-6 lg:px-8">
        <!-- Background Decoration -->
        <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden">
            <div
                class="absolute -top-[20%] -right-[10%] w-150 h-150 rounded-full bg-primary/10 blur-[100px] dark:bg-primary/5">
            </div>
            <div
                class="absolute -bottom-[20%] -left-[10%] w-125 h-125 rounded-full bg-purple-500/10 blur-[100px] dark:bg-purple-500/5">
            </div>
        </div>
        <div class="relative z-10 w-full max-w-4xl flex flex-col items-center gap-12">
            <!-- Hero Section -->
            <div class="text-center max-w-2xl mx-auto space-y-4">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-wider mb-4">
                    <span class="w-2 h-2 rounded-full bg-primary animate-pulse"></span>
                    New Features Available
                </div>
                <h1
                    class="text-4xl sm:text-5xl lg:text-6xl font-black text-text-main-light dark:text-text-main-dark leading-tight tracking-tight">
                    Shorten your links, <br />
                    <span class="text-transparent bg-clip-text bg-linear-to-r from-blue-300 to-purple-600">expand your
                        reach.</span>
                </h1>
                <p class="text-lg text-text-sub-light dark:text-text-sub-dark max-w-xl mx-auto leading-relaxed">
                    Paste your long URL below to create a short, manageable link that is
                    perfect for social media, emails, and text messages.
                </p>
            </div>
            <!-- Input Box -->
            <div class="w-full max-w-3xl transform transition-all hover:scale-[1.01] duration-300">
                <div
                    class="bg-card-light dark:bg-card-dark p-2 rounded-xl shadow-lg border border-border-light dark:border-border-dark flex flex-col sm:flex-row items-center gap-2">
                    <div class="flex-1 w-full flex items-center px-4 h-14 sm:h-16">
                        <span
                            class="material-symbols-outlined text-text-sub-light dark:text-text-sub-dark mr-3">link</span>
                        <input id="url-input"
                            class="w-full bg-transparent border-none text-text-main-light dark:text-text-main-dark text-lg placeholder:text-text-sub-light/60 focus:ring-0 p-0"
                            placeholder="https://example.com/very-long-url-to-shorten..." type="url" />
                    </div>
                    <button id="shorten-btn" onclick="shortenUrl()"
                        class="w-full sm:w-auto min-w-35 h-12 sm:h-14 bg-primary hover:bg-primary-hover text-white text-base font-bold rounded-lg px-8 transition-colors shadow-md flex items-center justify-center gap-2">
                        <span id="btn-icon" class="material-symbols-outlined">auto_fix_high</span>
                        <span id="btn-text">Shorten</span>
                    </button>
                </div>
                <!-- Validation/Helper Text -->
                <p
                    class="mt-3 text-sm text-text-sub-light dark:text-text-sub-dark flex items-center justify-center sm:justify-start gap-1 px-2">
                    <span class="material-symbols-outlined text-[16px]">info</span>
                    By clicking Shorten, you agree to our Terms of Service.
                </p>
            </div>
            <!-- Result Card -->
            <div id="result-card" class="w-full max-w-3xl animate-fade-in-up hidden">
                <div
                    class="bg-card-light dark:bg-card-dark rounded-xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-border-light dark:border-border-dark overflow-hidden">
                    <!-- Card Header -->
                    <div
                        class="bg-primary/5 dark:bg-primary/10 px-6 py-4 border-b border-border-light dark:border-border-dark flex items-center justify-between">
                        <div class="flex items-center gap-2 text-primary font-semibold">
                            <span class="material-symbols-outlined">check_circle</span>
                            <span>Your short link is ready!</span>
                        </div>
                        <div class="text-xs text-text-sub-light dark:text-text-sub-dark">
                            Expires in 30 days
                        </div>
                    </div>
                    <div class="p-6 sm:p-8 flex flex-col md:flex-row gap-8 items-start md:items-center">
                        <!-- QR Code Area -->
                        <div class="shrink-0 mx-auto md:mx-0">
                            <div
                                class="w-32 h-32 bg-white rounded-lg border-2 border-primary/20 p-2 flex items-center justify-center shadow-sm group relative cursor-pointer">
                                <!-- Abstract QR representation using CSS Grid or background -->
                                <img id="qr-code-img" class="w-full h-full object-contain"
                                    alt="QR Code for shortened URL" src="" />
                                <div
                                    class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-md">
                                    <span class="material-symbols-outlined text-white text-3xl">download</span>
                                </div>
                            </div>
                            <p class="text-xs text-center mt-2 text-text-sub-light font-medium">
                                Click to download
                            </p>
                        </div>
                        <!-- Link Info -->
                        <div class="grow w-full space-y-6">
                            <!-- Original Link -->
                            <div class="space-y-1">
                                <p
                                    class="text-xs font-semibold text-text-sub-light dark:text-text-sub-dark uppercase tracking-wide">
                                    Original Link
                                </p>
                                <p id="original-url-display"
                                    class="text-sm text-text-main-light dark:text-text-main-dark truncate max-w-md opacity-70">
                                </p>
                            </div>
                            <!-- Shortened Link & Actions -->
                            <div
                                class="bg-background-light dark:bg-background-dark/50 rounded-lg p-4 border border-border-light dark:border-border-dark flex flex-col sm:flex-row items-center justify-between gap-4">
                                <div class="flex items-center gap-3 overflow-hidden w-full sm:w-auto">
                                    <span class="material-symbols-outlined text-primary">link</span>
                                    <a id="short-url-link"
                                        class="text-xl sm:text-2xl font-bold text-primary hover:underline truncate"
                                        href="#" target="_blank"></a>
                                </div>
                                <div class="flex items-center gap-2 w-full sm:w-auto">
                                    <button id="copy-btn" onclick="copyToClipboard()"
                                        class="flex-1 sm:flex-none h-10 px-4 bg-primary hover:bg-primary-hover text-white rounded-md text-sm font-semibold transition-colors flex items-center justify-center gap-2 shadow-sm">
                                        <span id="copy-icon"
                                            class="material-symbols-outlined text-[18px]">content_copy</span>
                                        <span id="copy-text">Copy</span>
                                    </button>
                                    <button
                                        class="h-10 w-10 bg-white dark:bg-card-dark hover:bg-background-light dark:hover:bg-background-dark border border-border-light dark:border-border-dark text-text-main-light dark:text-text-main-dark rounded-md flex items-center justify-center transition-colors"
                                        title="Share">
                                        <span class="material-symbols-outlined text-[18px]">share</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Features Grid (Compact) -->
            <div
                class="grid grid-cols-1 sm:grid-cols-3 gap-6 w-full max-w-4xl pt-8 border-t border-border-light dark:border-border-dark/30">
                <div
                    class="flex flex-col items-center text-center gap-2 p-4 rounded-lg hover:bg-card-light dark:hover:bg-card-dark transition-colors">
                    <div
                        class="h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-primary mb-2">
                        <span class="material-symbols-outlined">analytics</span>
                    </div>
                    <h3 class="font-bold text-text-main-light dark:text-text-main-dark">
                        Detailed Analytics
                    </h3>
                    <p class="text-sm text-text-sub-light dark:text-text-sub-dark">
                        Track clicks and location data.
                    </p>
                </div>
                <div
                    class="flex flex-col items-center text-center gap-2 p-4 rounded-lg hover:bg-card-light dark:hover:bg-card-dark transition-colors">
                    <div
                        class="h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 mb-2">
                        <span class="material-symbols-outlined">link_off</span>
                    </div>
                    <h3 class="font-bold text-text-main-light dark:text-text-main-dark">
                        Custom Aliases
                    </h3>
                    <p class="text-sm text-text-sub-light dark:text-text-sub-dark">
                        Create memorable custom links.
                    </p>
                </div>
                <div
                    class="flex flex-col items-center text-center gap-2 p-4 rounded-lg hover:bg-card-light dark:hover:bg-card-dark transition-colors">
                    <div
                        class="h-12 w-12 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 mb-2">
                        <span class="material-symbols-outlined">qr_code_2</span>
                    </div>
                    <h3 class="font-bold text-text-main-light dark:text-text-main-dark">
                        QR Codes
                    </h3>
                    <p class="text-sm text-text-sub-light dark:text-text-sub-dark">
                        Generate QR codes instantly.
                    </p>
                </div>
            </div>
        </div>
    </main>
</body>
<script>
    // ─────────────────────────────────────────────────────────────────────────
    // State
    // ─────────────────────────────────────────────────────────────────────────
    let currentShortUrl = "";

    // ─────────────────────────────────────────────────────────────────────────
    // DOM Elements
    // ─────────────────────────────────────────────────────────────────────────
    const urlInput = document.getElementById("url-input");
    const shortenBtn = document.getElementById("shorten-btn");
    const btnIcon = document.getElementById("btn-icon");
    const btnText = document.getElementById("btn-text");
    const resultCard = document.getElementById("result-card");
    const originalUrlDisplay = document.getElementById("original-url-display");
    const shortUrlLink = document.getElementById("short-url-link");
    const copyBtn = document.getElementById("copy-btn");
    const copyIcon = document.getElementById("copy-icon");
    const copyText = document.getElementById("copy-text");
    const qrCodeImg = document.getElementById("qr-code-img");

    // ─────────────────────────────────────────────────────────────────────────
    // URL Shortening
    // ─────────────────────────────────────────────────────────────────────────
    async function shortenUrl() {
        const url = urlInput.value.trim();

        // Validate URL
        if (!url) {
            showError("Please enter a URL");
            return;
        }

        if (!isValidUrl(url)) {
            showError("Please enter a valid URL (including http:// or https://)");
            return;
        }

        // Show loading state
        setLoading(true);

        try {
            const response = await fetch("/api/shorten", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ url }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.detail || "Failed to shorten URL");
            }

            const data = await response.json();

            // Build full short URL
            const baseUrl = window.location.origin;
            currentShortUrl = `${baseUrl}${data.short_url}`;

            // Update UI
            displayResult(data.original_url, currentShortUrl, data.slug);
        } catch (error) {
            console.error("Error:", error);
            showError(error.message || "Something went wrong. Please try again.");
        } finally {
            setLoading(false);
        }
    }

    // ─────────────────────────────────────────────────────────────────────────
    // Display Result
    // ─────────────────────────────────────────────────────────────────────────
    function displayResult(originalUrl, shortUrl, slug) {
        // Update text displays
        originalUrlDisplay.textContent = originalUrl;
        shortUrlLink.textContent = shortUrl
            .replace("https://", "")
            .replace("http://", "");
        shortUrlLink.href = shortUrl;

        // Generate QR code using QR Server API
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(shortUrl)}`;
        qrCodeImg.src = qrUrl;

        // Show result card with animation
        resultCard.classList.remove("hidden");
        resultCard.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }

    // ─────────────────────────────────────────────────────────────────────────
    // Copy to Clipboard
    // ─────────────────────────────────────────────────────────────────────────
    async function copyToClipboard() {
        if (!currentShortUrl) return;

        try {
            await navigator.clipboard.writeText(currentShortUrl);

            // Show success feedback
            copyIcon.textContent = "check";
            copyText.textContent = "Copied!";
            copyBtn.classList.add("bg-green-600", "hover:bg-green-700");
            copyBtn.classList.remove("bg-primary", "hover:bg-primary-hover");

            // Reset after 2 seconds
            setTimeout(() => {
                copyIcon.textContent = "content_copy";
                copyText.textContent = "Copy";
                copyBtn.classList.remove("bg-green-600", "hover:bg-green-700");
                copyBtn.classList.add("bg-primary", "hover:bg-primary-hover");
            }, 2000);
        } catch (error) {
            console.error("Failed to copy:", error);
            showError("Failed to copy to clipboard");
        }
    }

    // ─────────────────────────────────────────────────────────────────────────
    // UI Helpers
    // ─────────────────────────────────────────────────────────────────────────
    function setLoading(isLoading) {
        shortenBtn.disabled = isLoading;

        if (isLoading) {
            btnIcon.textContent = "hourglass_empty";
            btnIcon.classList.add("animate-spin");
            btnText.textContent = "Shortening...";
            shortenBtn.classList.add("opacity-75", "cursor-not-allowed");
        } else {
            btnIcon.textContent = "auto_fix_high";
            btnIcon.classList.remove("animate-spin");
            btnText.textContent = "Shorten";
            shortenBtn.classList.remove("opacity-75", "cursor-not-allowed");
        }
    }

    function showError(message) {
        // Simple alert for now - could be replaced with toast notification
        alert(message);
    }

    function isValidUrl(string) {
        try {
            const url = new URL(string);
            return url.protocol === "http:" || url.protocol === "https:";
        } catch (_) {
            return false;
        }
    }

    // ─────────────────────────────────────────────────────────────────────────
    // QR Code Download
    // ─────────────────────────────────────────────────────────────────────────
    async function downloadQrCode() {
        if (!qrCodeImg.src) return;

        try {
            // Fetch the QR code image
            const response = await fetch(qrCodeImg.src);
            const blob = await response.blob();

            // Create download link
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "qr-code.png";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        } catch (error) {
            console.error("Failed to download QR code:", error);
            showError("Failed to download QR code");
        }
    }

    // ─────────────────────────────────────────────────────────────────────────
    // Event Listeners
    // ─────────────────────────────────────────────────────────────────────────
    // Allow pressing Enter to submit
    urlInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
            shortenUrl();
        }
    });

    // QR code click to download
    qrCodeImg.parentElement.addEventListener("click", downloadQrCode);
</script>

</html>